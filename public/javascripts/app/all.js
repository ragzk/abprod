var APP=angular.module("APP",["matchmedia-ng","ngProgress","ngSanitize","ui.bootstrap"]);$(document).ready(function(){$(".slider3").bxSlider({slideWidth:5e3,minSlides:2,maxSlides:4,slideMargin:10})}),APP.controller("agentController",["$http",function(t){this.agents=[],this.init=function(e){that=this,this.agentId=e.agentId,t.get("/agentDetails/"+this.agentId,{params:{agentId:this.agentId}}).then(function(t){that.agent=t.data})},this.initNew=function(){that=this,t.get("/agents/getAgents").then(function(t){that.agents=t.data})}}]),APP.controller("buyController",["$http",function(t){this.properties=[],this.init=function(e){this.type=e.type,this.getPropertiesUrl=e.getPropertiesUrl,that=this,t.get(this.getPropertiesUrl,{params:{type:this.type}}).then(function(t){that.properties=t.data})}}]),APP.controller("mainController",["$scope","ngProgressFactory",function(t,e){t.progressbar=e.createInstance();var r=t.$bus().channel("ngProgressChannel");r.subscribe("ngProgressChannelStart",function(e){t.progressbar.start()}),r.subscribe("ngProgressChannelComplete",function(e){t.progressbar.complete()}),r.publish("ngProgressChannelStart"),r.publish("ngProgressChannelComplete")}]),APP.controller("propertyController",["$http",function(t){this.property={},this.init=function(e){this.uniqueId=e.uniqueId,that=this,t.get("/property/getProperty/"+this.uniqueId,{params:{uniqueId:this.uniqueId}}).then(function(t){that.property=t.data})}}]),APP.controller("searchController",["$scope","matchmedia",function(t,e){t.matchMedia=e,t.isDesktop=e.isDesktop(),t.search={},t.search.types=["Buy","Rent","Sold"],t.search.propertyTypes=["Any property type","House","Apartment","Commercial"],t.search.selectedType=0;e.onPhone(function(e){t.isDesktop=!e.matches})}]),APP.controller("sidebarController",["$scope","ngProgressFactory","$location","$window",function(t,e,r,n){t.progressbar=e.createInstance();var s=t.$bus().channel("ngProgressChannel");t.loading=!0,s.subscribe("ngProgressChannelStart",function(e){t.progressbar.start()}),s.subscribe("ngProgressChannelComplete",function(e){t.progressbar.complete()}),t.toggle=!1,t.buy=function(){n.location.href="/buy"};var i=null,o=r.absUrl().split(/[\s/]+/),a=null;o&&o.length>=3&&(i=o[2],a="/"+o[2]),4==o.length&&(a=a+"/"+o[3]),i?_.each($(".title.parent"),function(t){$(t).find("a").attr("href")=="/"+i||$(t).find("div:first").slideToggle("slow")}):$(".list-group-item.child").slideToggle("fast"),t.toggleMenu=function(e){t.toggle=!t.toggle,$(e.target.parentElement).find("div").slideToggle("slow"),$("#content").load($(this).find("a").attr("href"))},$(".title a a").click(function(){return $("#content").load($(this).attr("href")),!0}),a&&_.each($("*[data-link]"),function(t){if($(t).attr("href")==a){var e=$(t).parent().parent();4==o.length&&(e=e.parent()),e.addClass("open").find(".submenu").css({display:"block"})}}),t.loading=!1,s.publish("ngProgressChannelStart"),s.publish("ngProgressChannelComplete")}]),$(function(){var t=function(t,e){this.el=t||{},this.multiple=e||!1;var r=this.el.find(".link");r.on("click",{el:this.el,multiple:this.multiple},this.dropdown)};t.prototype.dropdown=function(t){var e=t.data.el;$this=$(this),$next=$this.next(),$next.slideToggle(),$this.parent().toggleClass("open"),t.data.multiple||e.find(".submenu").not($next).slideUp().parent().removeClass("open")};new t($("#accordion"),!1)}),APP.directive("agentDetails",function(){return{replace:!1,transclude:!0,scope:{agent:"="},templateUrl:"/public/templates/agentDetails.html",link:function(t,e,r){}}}),APP.directive("agentDetailsSummary",function(){return{replace:!1,transclude:!0,scope:{agent:"="},templateUrl:"/public/templates/agentDetailsSummary.html",link:function(t,e,r){}}}),APP.directive("bxSlider",["$http","$compile","$timeout",function(t,e,r){return{scope:{},template:'<div class="bxslider1"><div class="slide" ng-repeat="image in images track by $index"><img ng-if="$index === 0" class="sliderimg" ng-src="{{image.imageUrl}}" alt="" /><img ng-if="$index > 0" class="sliderimg" data-src="{{image.imageUrl}}"  alt="" /><div class="bxslider-property-details"><div class="bxslider-property-features"><span ng-show="image.propertyFeature.bedroom">{{ image.propertyFeature.bedroom }}<span class="fa fa-bed spacing-icon"></span></span><span class="extra-spacing-icon" ng-show="image.propertyFeature.bathroom">{{ image.propertyFeature.bathroom }}<img class="bath-icon spacing-icon" src="/public/images/icons/bath.png" /></span><span class="extra-spacing-icon" ng-show="image.propertyFeature.garages || image.propertyFeature.carports">{{image.propertyFeature.garages + image.propertyFeature.carports}}<span class="fa fa-car spacing-icon"></span></span></div><div><span>{{image.propertyAddressAsText}}</span></div></div></div>',link:function(e,n,s){var i=function(t){e.images=t.data||t,e.showdetails&&_.each(e.images,function(t){t.propertyFeature=_.head(t.propertyfeatures),t.propertyAddress=_.head(t.propertyaddresses),t.propertyAddress&&(t.propertyAddressAsText=t.propertyAddress.suburb+", "+t.propertyAddress.streetNumber+" "+t.propertyAddress.street)});var s=n;r(function(){$(s.children(".bxslider1")).bxSlider({slideWidth:5e3,minSlides:1,maxSlides:1,auto:!0,pager:!1,slideMargin:10,onSlideBefore:function(t,e,r){console.log(t);var n=$(t.children()[0]),s=n.data().src;s&&n.attr("src",s).removeAttr("data-src")}})},0,!1)};e.showdetails=s.showdetails,s.url&&t.get(s.url).then(i),s.data&&i(JSON.parse(s.data))}}}]),APP.directive("contact",["$http","$compile","$timeout","$uibModal",function(t,e,r,n){return{replace:!1,transclude:!0,scope:{},templateUrl:"/public/templates/contact.html",link:function(e,r,s){e.buttonDisabled=!1,e.submitted=!1,e.submitForm=function(){if(e.submitted=!0,e.contactForm.$valid){e.buttonDisabled=!0;var r={name:e.name,email:e.email,subject:e.subject,message:e.message};t.post("/contact/save",JSON.stringify(r)).success(function(){var t=n.open({template:'<div class="modal-header"><h3 class="modal-title">Contact information successfully submitted</h3></div><div class="modal-body">Thankyou for submitting details.<br/> We will get back to you</div><div class="modal-footer"><button class="btn btn-default btn-primary btn-md" type="button" ng-click="ok()">OK</button></div>',controller:"ModalInstanceContactCtrl"});t.result.then(function(){},function(){})})}}}}}]),APP.controller("ModalInstanceContactCtrl",["$scope","$uibModalInstance","$window",function(t,e,r){t.ok=function(){e.close(),r.location.href="/"},t.cancel=function(){e.dismiss("cancel")}}]),APP.directive("propertyAppraisal",["$http","$compile","$timeout","$uibModal",function(t,e,r,n){return{replace:!1,transclude:!0,scope:{},templateUrl:"/public/templates/propertyAppraisal.html",link:function(e,r,s){e.buttonDisabled=!1,e.submitted=!1,e.submitForm=function(){if(e.submitted=!0,e.propertyApprisalForm.$valid){e.buttonDisabled=!0;var r={fullname:e.fullname,email:e.email,phoneNumber:e.phoneNumber,propertyAddress:e.propertyAddress};t.post("/propertyAppraisal/save",JSON.stringify(r)).success(function(){var t=n.open({template:'<div class="modal-header"><h3 class="modal-title">Property Appraisal successfully submitted</h3></div><div class="modal-body">Thankyou for submitting details.<br/> We will get back to you</div><div class="modal-footer"><button class="btn btn-default btn-primary btn-md" type="button" ng-click="ok()">OK</button></div>',controller:"ModalInstanceCtrl"});t.result.then(function(){},function(){})})}}}}}]),APP.controller("ModalInstanceCtrl",["$scope","$uibModalInstance","$window",function(t,e,r){t.ok=function(){e.close(),r.location.href="/"},t.cancel=function(){e.dismiss("cancel")}}]),APP.directive("propertyDetails",function(){return{replace:!1,transclude:!0,scope:{property:"="},templateUrl:"/public/templates/propertyDetails.html",link:function(t,e,r){t.$watch("property",function(){if(t.property.uniqueId){t.transaction=t.property.rent?"Rent":"Sale",t.transactionPrice=t.property.rent?t.property.rent:t.property.priceValue,t.propertyAddress=_.head(t.property.propertyaddresses),t.propertyFeature=_.head(t.property.propertyfeatures);var e=_.head(t.property.propertydescriptions);e&&e.propertydescription&&(t.propertyDescription=e.propertydescription,t.propertyDescription=t.propertyDescription.replace(/\r\n\r\n/g,"</p><p>").replace(/\n\n/g,"</p><p>"),t.propertyDescription=t.propertyDescription.replace(/\r\n/g,"<br />").replace(/\n/g,"<br />")),t.propertyAddress&&(t.propertyAddressAsText=t.propertyAddress.streetNumber+" "+t.propertyAddress.street+", "+t.propertyAddress.suburb)}})}}}),APP.directive("shortPropertyDetails",function(){return{replace:!1,transclude:!0,scope:{property:"=property"},templateUrl:"/public/templates/shortPropertyDetails.html",link:function(t,e,r){t.propertyAddress=_.head(t.property.propertyaddresses),t.propertyFeature=_.head(t.property.propertyfeatures);var n=_.head(t.property.propertydescriptions);if(n&&n.propertydescription&&(t.propertyDescription=n.propertydescription),t.propertyAddress&&(t.propertyAddressAsText=t.propertyAddress.streetNumber+" "+t.propertyAddress.street+", "+t.propertyAddress.suburb),t.property.inspectionTimes){var s=null;_.each(t.property.inspectionTimes.split(","),function(e){var r=e;r&&_.first(r.split(" to"))&&moment(_.first(r.split(" to")),"DD/MMM/YYYY").toDate()>moment(Date.now()).toDate()?s=s?s+", "+r:r:t.property.inspectionTimes=null}),t.property.inspectionTimes=s}}}}),APP.directive("showSelected",["$timeout",function(t){return{link:function(e,r,n){t(function(){var t=$(r.find("li a")[0]).text();r.parents(".btn-group").find(".dropdown-toggle").html(t+'<span class="caret"></span>'),r.find("li a").on("click",function(){var t=$(this).text();$(this).parents(".btn-group").find(".dropdown-toggle").html(t+'<span class="caret"></span>')})})}}}]),APP.directive("select2",["$timeout",function(t){return{link:function(t,e,r){e.select2({minimumResultsForSearch:-1})}}}]),APP.config(["$provide",function(t){t.decorator("$rootScope",["$delegate",function(t){return t.constructor.prototype.$bus=function(){var t=this,e=$.extend({},postal,{subscribe:function(){var e=postal.subscribe.apply(postal,arguments);return t.$on("$destroy",function(){e.unsubscribe()}),e}});return e},t}])}]),APP.filter("cut",function(){return function(t,e,r,n){if(!t)return"";if(r=parseInt(r,10),!r)return t;if(t.length<=r)return t;if(t=t.substr(0,r),e){var s=t.lastIndexOf(" ");-1!=s&&("."!=t.charAt(s-1)&&","!=t.charAt(s-1)||(s-=1),t=t.substr(0,s))}return t+(n||" …")}});